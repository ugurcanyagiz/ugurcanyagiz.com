---
import Layout from "../layouts/Layout.astro";
const videoId = "wupToqz1e2g";
---

<Layout title="JLOG! â€” Ugurcan">
  <section class="jlog">
    <div class="stage">
      <div id="ytPlayer" class="player" aria-label="JLOG video player"></div>

      <button id="soundPill" class="sound-pill" type="button" aria-pressed="false">
        <span class="dot" aria-hidden="true"></span>
        Unmute
      </button>
    </div>
  </section>

  <style>
    /* Center the stage on the page */
    .jlog{
      min-height: calc(100vh - 64px - 72px);
      display: grid;
      place-items: center;
      padding: 22px 18px 60px;
    }

    /* The frame */
    .stage{
      position: relative;
      width: min(1100px, 100%);
      aspect-ratio: 16 / 9;
      border-radius: 22px;
      overflow: hidden;

      background: rgba(0,0,0,0.06);
      box-shadow: 0 18px 60px rgba(0,0,0,.12);
    }

    /* Player fills stage */
    .player{
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    /*
      COVER (important):
      - YouTube video is portrait, stage is landscape.
      - To fully fill stage, we oversize + center the iframe (crop edges).
    */
    .player :global(iframe){
      position: absolute !important;
      top: 50% !important;
      left: 50% !important;

      /* cover sizing */
      width: 160% !important;
      height: 160% !important;

      transform: translate(-50%, -50%) !important;
      border: 0 !important;
      display: block !important;
    }

    /* Pill button */
    .sound-pill{
      position: absolute;
      right: 14px;
      bottom: 14px;
      z-index: 5;

      display: inline-flex;
      align-items: center;
      gap: 8px;

      border-radius: 999px;
      padding: 10px 12px;

      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(18,18,22,0.55);
      backdrop-filter: blur(14px);

      color: rgba(255,255,255,0.92);
      font-size: 13px;
      font-weight: 650;
      letter-spacing: -0.01em;

      cursor: pointer;
      user-select: none;

      transition: transform .15s ease, background .15s ease, border-color .15s ease;
    }

    .sound-pill:hover{
      transform: translateY(-1px);
      background: rgba(18,18,22,0.70);
      border-color: rgba(255,255,255,0.30);
    }

    .dot{
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: rgba(255,255,255,0.7);
      box-shadow: 0 0 0 3px rgba(255,255,255,0.10);
    }

    /* Unmuted state */
    .sound-pill.is-on{
      background: rgba(255,255,255,0.80);
      border-color: rgba(0,0,0,0.08);
      color: rgba(11,11,15,0.92);
    }
    .sound-pill.is-on .dot{
      background: rgba(52,199,89,0.95);
      box-shadow: 0 0 0 3px rgba(52,199,89,0.18);
    }

    @media (max-width: 520px){
      .jlog{ padding: 18px 12px 50px; }
      .stage{ border-radius: 18px; }

      /* mobile: more cover */
      .player :global(iframe){
        width: 220% !important;
        height: 220% !important;
      }

      .sound-pill{ right: 10px; bottom: 10px; padding: 9px 11px; }
    }
  </style>

  <script is:inline define:vars={{ videoId }}>
    function loadYouTubeAPI() {
      return new Promise((resolve) => {
        if (window.YT && window.YT.Player) return resolve();

        const existing = document.querySelector('script[data-yt-api="1"]');
        if (!existing) {
          const tag = document.createElement('script');
          tag.src = "https://www.youtube.com/iframe_api";
          tag.async = true;
          tag.dataset.ytApi = "1";
          document.head.appendChild(tag);
        }

        const prev = window.onYouTubeIframeAPIReady;
        window.onYouTubeIframeAPIReady = () => {
          try { if (typeof prev === "function") prev(); } catch(_) {}
          resolve();
        };

        const t = setInterval(() => {
          if (window.YT && window.YT.Player) { clearInterval(t); resolve(); }
        }, 50);
        setTimeout(() => clearInterval(t), 5000);
      });
    }

    let player;
    let isUnmuted = false;

    const pill = document.getElementById("soundPill");
    const mountId = "ytPlayer";

    function setPillState(on) {
      isUnmuted = on;
      pill.classList.toggle("is-on", on);
      pill.childNodes.forEach(n => { if (n.nodeType === Node.TEXT_NODE) n.textContent = ""; });
      pill.lastChild && pill.lastChild.nodeType === Node.TEXT_NODE && (pill.lastChild.textContent = "");
      pill.setAttribute("aria-pressed", on ? "true" : "false");
      // Set text safely
      pill.innerHTML = `<span class="dot" aria-hidden="true"></span>${on ? "Mute" : "Unmute"}`;
    }

    async function init() {
      await loadYouTubeAPI();

      player = new YT.Player(mountId, {
        videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          controls: 0,
          rel: 0,
          modestbranding: 1,
          playsinline: 1,
          loop: 1,
          playlist: videoId
        },
        events: {
          onReady: (e) => {
            try { e.target.mute(); e.target.playVideo(); } catch (_) {}
            setPillState(false);
          }
        }
      });

      pill.addEventListener("click", () => {
        if (!player) return;

        if (!isUnmuted) {
          try { player.unMute(); player.setVolume(100); player.playVideo(); } catch (_) {}
          setPillState(true);
        } else {
          try { player.mute(); } catch (_) {}
          setPillState(false);
        }
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init, { once: true });
    } else {
      init();
    }
  </script>
</Layout>
