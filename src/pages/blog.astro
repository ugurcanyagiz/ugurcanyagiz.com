---
import Layout from "../layouts/Layout.astro";

const videoId = "wupToqz1e2g";
---

<Layout title="JLOG! â€” Ugurcan">
  <section class="jlog">
    <div class="stage">
      <div id="ytPlayer" class="player" aria-label="JLOG video player"></div>

      <button id="soundPill" class="sound-pill" type="button" aria-pressed="false">
        <span class="dot" aria-hidden="true"></span>
        Unmute
      </button>
    </div>
  </section>

  <style>
/* Responsive centered video canvas */
.stage{
  position: relative;
  width: min(1040px, 100%);
  aspect-ratio: 16 / 9;
  border-radius: 22px;
  overflow: hidden;

  background: rgba(0,0,0,0.06);
  box-shadow: 0 18px 60px rgba(0,0,0,.12);
}

/* player fills stage */
.player{
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
}

/*
  COVER MODE (important):
  - We intentionally oversize + center the iframe.
  - This removes the empty sides and fills the frame.
  - Crops edges if necessary (like "object-fit: cover").
*/
.player :global(iframe){
  position: absolute !important;
  top: 50% !important;
  left: 50% !important;

  /* oversize (cover) */
  width: 140% !important;
  height: 140% !important;

  transform: translate(-50%, -50%) !important;
  border: 0 !important;
  display: block !important;
}

/* Mobile: slightly less crop (optional) */
@media (max-width: 520px){
  .player :global(iframe){
    width: 160% !important;
    height: 160% !important;
  }
}
  </style>

  <script is:inline define:vars={{ videoId }}>
    function loadYouTubeAPI() {
      return new Promise((resolve) => {
        if (window.YT && window.YT.Player) return resolve();

        const existing = document.querySelector('script[data-yt-api="1"]');
        if (!existing) {
          const tag = document.createElement('script');
          tag.src = "https://www.youtube.com/iframe_api";
          tag.async = true;
          tag.dataset.ytApi = "1";
          document.head.appendChild(tag);
        }

        const prev = window.onYouTubeIframeAPIReady;
        window.onYouTubeIframeAPIReady = () => {
          try { if (typeof prev === "function") prev(); } catch(_) {}
          resolve();
        };

        // If API loads but doesn't call onYouTubeIframeAPIReady for some reason:
        const t = setInterval(() => {
          if (window.YT && window.YT.Player) { clearInterval(t); resolve(); }
        }, 50);
        setTimeout(() => clearInterval(t), 5000);
      });
    }

    let player;
    let isUnmuted = false;

    const pill = document.getElementById("soundPill");
    const mountId = "ytPlayer";

    function setPillState(on) {
      isUnmuted = on;
      pill.classList.toggle("is-on", on);
      pill.textContent = on ? "Mute" : "Unmute";
      pill.setAttribute("aria-pressed", on ? "true" : "false");
    }

    async function init() {
      await loadYouTubeAPI();

      player = new YT.Player(mountId, {
        videoId,
        playerVars: {
          autoplay: 1,
          mute: 1,
          controls: 0,
          rel: 0,
          modestbranding: 1,
          playsinline: 1,
          loop: 1,
          playlist: videoId
        },
        events: {
          onReady: (e) => {
            try {
              e.target.mute();
              e.target.playVideo();
            } catch (_) {}
            setPillState(false);
          }
        }
      });

      pill.addEventListener("click", () => {
        if (!player) return;

        if (!isUnmuted) {
          try {
            player.unMute();
            player.setVolume(100);
            player.playVideo();
          } catch (_) {}
          setPillState(true);
        } else {
          try { player.mute(); } catch (_) {}
          setPillState(false);
        }
      });
    }

    if (document.readyState === "loading") {
      document.addEventListener("DOMContentLoaded", init, { once: true });
    } else {
      init();
    }
  </script>
</Layout>
